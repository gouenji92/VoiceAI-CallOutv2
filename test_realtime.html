<!DOCTYPE html>
<html>
<head>
    <title>Supabase Realtime Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Supabase Realtime Test Listener</h1>
    <p>Mở Bảng điều khiển (Nhấn F12) -> chọn tab "Console" để xem log.</p>

    <script>
        // --- 2. THÔNG TIN CỦA BẠN ---
        const SUPABASE_URL = "https://vmffnryqvntucusjqhoy.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZtZmZucnlxdm50dWN1c2pxaG95Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MTE2MDYsImV4cCI6MjA3NjA4NzYwNn0.uy11_QL1WiS1yg5RRqKOZBgz6vh1yFqM8iwmYYAYdw8";

        // --- 3. Khởi tạo Client (ĐÃ SỬA LỖI) ---
        // Sửa: Đổi tên biến thành "supabaseClient" để không trùng với thư viện "supabase"
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        console.log("Đã khởi tạo Supabase JS Client.");

        // --- 4. HÀM LẮNG NGHE REALTIME ---
        function subscribeToAllLogs() {
            console.log("Đang bật Realtime cho bảng 'conversation_logs'...");

            // Sửa: Dùng biến "supabaseClient" mới
            const channel = supabaseClient
                .channel('realtime_test_channel') // Tên kênh bất kỳ
                .on(
                    'postgres_changes',
                    {
                        event: 'INSERT', // Chỉ lắng nghe sự kiện INSERT
                        schema: 'public',
                        table: 'conversation_logs'
                    },
                    (payload) => {
                        // Đây là nơi log realtime sẽ xuất hiện!
                        console.log('--- ⚡ LOG MỚI (REALTIME TỪ JAVASCRIPT) ⚡ ---');
                        const newLog = payload.new;
                        console.log(`  Speaker: ${newLog.speaker}`);
                        console.log(`  Text: ${newLog.text}`);
                        console.log(`  Intent: ${newLog.intent}`);
                        console.log('-------------------------------------------');
                    }
                )
                .subscribe((status, err) => {
                    if (status === 'SUBSCRIBED') {
                        console.log('✅ Đã kết nối Realtime thành công! Đang chờ log...');
                    }
                    if (status === 'CHANNEL_ERROR') {
                        console.error('❌ Lỗi kênh Realtime:', err);
                    }
                });

            return channel;
        }

        // Chạy hàm lắng nghe ngay lập tức
        subscribeToAllLogs();
    </script>
</body>
</html>