================================================================================
  HÆ¯á»šNG DáºªN HOÃ€N THÃ€NH 100% Dá»° ÃN VOICEAI
  Bao gá»“m: Backend + Database + NLP + Deeppavlov Agent + Asterisk
================================================================================

ğŸ“‹ CHECKLIST HOÃ€N THÃ€NH:
  âœ… Database Supabase (PostgreSQL 15)
  âœ… Backend API FastAPI (Python 3.11)
  âœ… NLP PhoBERT (Intent + Sentiment + Entity)
  ğŸ¯ Deeppavlov Agent (Conversation Manager) - CHUáº¨N Bá»Š CHáº Y
  âš ï¸  Asterisk Integration - OPTIONAL (cáº§n server tháº­t)

================================================================================
ğŸš€ BÆ¯á»šC 1: CHáº Y DEEPPAVLOV AGENT (QUAN TRá»ŒNG!)
================================================================================

Agent Server giÃºp xá»­ lÃ½ logic há»™i thoáº¡i thÃ´ng minh, Ä‘á»‹nh tuyáº¿n response dá»±a
trÃªn intent, sentiment vÃ  entities.

CÃCH 1: HTTP Agent (KHUYáº¾N NGHá»Š - Dá»… dÃ ng hÆ¡n)
---------------------------------------------
Má»Ÿ Terminal 1 (PowerShell):

  cd C:\Users\Admin\VoiceAI
  .\.venv\Scripts\Activate.ps1
  python agent/http_agent.py

Káº¿t quáº£ mong Ä‘á»£i:
  ============================================================
    ğŸ¤– DEEPPAVLOV AGENT SERVER (HTTP)
    Running on: http://localhost:4242
    Press CTRL+C to stop
  ============================================================
  INFO:     Application startup complete.

CÃCH 2: ZMQ Agent (NÃ¢ng cao - Cáº§n cÃ i dp_agent)
---------------------------------------------
Náº¿u muá»‘n dÃ¹ng DeepPavlov framework gá»‘c:

  pip install dp-agent
  python agent/run_agent.py

LÆ°u Ã½: HTTP Agent Ä‘Æ¡n giáº£n hÆ¡n vÃ  Ä‘Ã£ tÃ­ch há»£p sáºµn!

================================================================================
ğŸš€ BÆ¯á»šC 2: CHáº Y BACKEND API
================================================================================

Má»Ÿ Terminal 2 (PowerShell):

  cd C:\Users\Admin\VoiceAI
  .\.venv\Scripts\Activate.ps1
  python -X utf8 -m uvicorn app.main:app --reload

Káº¿t quáº£ mong Ä‘á»£i:
  INFO:     Application startup complete.
  Ket noi Supabase thanh cong!
  INFO:app.services.model_manager:ÄÃ£ táº£i mÃ´ hÃ¬nh thÃ nh cÃ´ng

Server cháº¡y táº¡i: http://127.0.0.1:8000

================================================================================
ğŸš€ BÆ¯á»šC 3: TEST Há»† THá»NG HOÃ€N CHá»ˆNH
================================================================================

Má»Ÿ Terminal 3 (PowerShell):

  cd C:\Users\Admin\VoiceAI
  .\.venv\Scripts\Activate.ps1
  python test_with_agent.py

Káº¿t quáº£ mong Ä‘á»£i:
  âœ… Agent server Ä‘ang cháº¡y táº¡i port 4242
  âœ… ÄÃ£ Ä‘Äƒng kÃ½: agent_test_xxx@gmail.com
  âœ… ÄÃ£ Ä‘Äƒng nháº­p
  âœ… Workflow ID: xxx
  âœ… ÄÃ£ táº¡o version
  âœ… Call ID: xxx
  
  TEST Há»˜I THOáº I Vá»šI AGENT:
  [1] ğŸ‘¤ User: Xin chÃ o
      ğŸ¤– Bot: Xin chÃ o! TÃ´i lÃ  trá»£ lÃ½ áº£o. TÃ´i cÃ³ thá»ƒ giÃºp gÃ¬ cho báº¡n hÃ´m nay?
  [2] ğŸ‘¤ User: TÃ´i muá»‘n Ä‘áº·t lá»‹ch khÃ¡m
      ğŸ¤– Bot: VÃ¢ng. Báº¡n muá»‘n Ä‘áº·t lá»‹ch vÃ o thá»i gian nÃ o áº¡?
  [3] ğŸ‘¤ User: 9h sÃ¡ng mai
      ğŸ¤– Bot: VÃ¢ng, tÃ´i sáº½ giÃºp báº¡n Ä‘áº·t lá»‹ch vÃ o lÃºc 9h. Báº¡n xÃ¡c nháº­n nhÃ©?
  [4] ğŸ‘¤ User: Cáº£m Æ¡n, táº¡m biá»‡t
      ğŸ¤– Bot: Cáº£m Æ¡n báº¡n Ä‘Ã£ liÃªn há»‡. ChÃºc báº¡n má»™t ngÃ y tá»‘t lÃ nh!
      âš¡ Action: hangup
  
  ğŸ‰ THÃ€NH CÃ”NG! Há»‡ thá»‘ng hoáº¡t Ä‘á»™ng hoÃ n chá»‰nh 100%

================================================================================
ğŸ“Š KIá»‚M TRA AGENT HOáº T Äá»˜NG
================================================================================

Test nhanh Agent server:

  curl http://localhost:4242/health

Káº¿t quáº£:
  {"status":"ok","message":"Agent server is running"}

Test API vá»›i Agent:

  # Xem logs trong Terminal 1 (Agent) Ä‘á»ƒ tháº¥y:
  [Agent] Nháº­n request:
    - Text: TÃ´i muá»‘n Ä‘áº·t lá»‹ch
    - Intent: dat_lich (confidence: 0.85)
    - Sentiment: neutral

================================================================================
âš™ï¸ TÃ™Y CHá»ˆNH AGENT (OPTIONAL)
================================================================================

File agent/http_agent.py chá»©a logic Ä‘á»‹nh tuyáº¿n:

  1. ThÃªm intent má»›i:
     elif intent == "huy_lich":
         return AgentResponse(
             response="Báº¡n muá»‘n há»§y lá»‹ch nÃ o áº¡?",
             action="cancel_appointment"
         )

  2. Thay Ä‘á»•i ngÆ°á»¡ng confidence:
     confidence_threshold = 0.7  # Máº·c Ä‘á»‹nh: 0.6

  3. TÃ­ch há»£p workflow_json:
     nodes = workflow_json.get("nodes", [])
     # Xá»­ lÃ½ theo flow graph

Sau khi chá»‰nh sá»­a, KHÃ”NG cáº§n restart - Agent tá»± reload!

================================================================================
ğŸ”§ Xá»¬ LÃ Lá»–I
================================================================================

Lá»–I 1: "Agent server CHÆ¯A cháº¡y!"
  Giáº£i phÃ¡p: Kiá»ƒm tra Terminal 1, Ä‘áº£m báº£o agent Ä‘ang cháº¡y port 4242
  
Lá»–I 2: "Port 4242 already in use"
  Giáº£i phÃ¡p A: Táº¯t tiáº¿n trÃ¬nh cÅ©
    Get-Process | Where-Object {$_.ProcessName -eq "python"} | Stop-Process -Force
  
  Giáº£i phÃ¡p B: Äá»•i port trong agent/http_agent.py:
    uvicorn.run(app, host="0.0.0.0", port=4243, log_level="info")
  
  Sau Ä‘Ã³ cáº­p nháº­t app/services/dialog_manager.py:
    AGENT_URL = "http://localhost:4243"

Lá»–I 3: Agent tráº£ vá» "Xin lá»—i, tÃ´i chÆ°a hiá»ƒu rÃµ..."
  NguyÃªn nhÃ¢n: Intent confidence tháº¥p hoáº·c intent chÆ°a Ä‘Æ°á»£c train
  Giáº£i phÃ¡p: 
    - Kiá»ƒm tra logs Ä‘á»ƒ xem confidence score
    - ThÃªm dá»¯ liá»‡u training trong train_intent_model.py
    - Cháº¡y láº¡i: python train_intent_model.py

================================================================================
ğŸŒŸ ASTERISK INTEGRATION (OPTIONAL - Cáº§n server tháº­t)
================================================================================

Náº¿u báº¡n cÃ³ Asterisk PBX server:

BÆ¯á»šC 1: Cáº­p nháº­t file .env

  ASTERISK_HOST=192.168.1.100        # IP cá»§a Asterisk server
  ASTERISK_PORT=5038                 # AMI port
  ASTERISK_USERNAME=admin            # AMI username
  ASTERISK_PASSWORD=secret           # AMI password
  ASTERISK_CONTEXT=from-internal     # Dialplan context
  ASTERISK_CHANNEL=SIP/trunk         # SIP channel
  ASTERISK_MOCK_MODE=false           # Táº®T mock mode

BÆ¯á»šC 2: CÃ i Ä‘áº·t dependencies

  pip install panoramisk

BÆ¯á»šC 3: Cáº¥u hÃ¬nh Asterisk AMI

  Trong file /etc/asterisk/manager.conf:
  
  [general]
  enabled = yes
  port = 5038
  bindaddr = 0.0.0.0

  [admin]
  secret = secret
  deny = 0.0.0.0/0.0.0.0
  permit = 127.0.0.1/255.255.255.0
  read = all
  write = all

BÆ¯á»šC 4: Restart Asterisk

  systemctl restart asterisk

BÆ¯á»šC 5: Test

  python test_full_system.py

  # Kiá»ƒm tra logs Ä‘á»ƒ tháº¥y cuá»™c gá»i tháº­t Ä‘Æ°á»£c initiate

LÆ¯U Ã: Náº¿u khÃ´ng cÃ³ Asterisk, há»‡ thá»‘ng tá»± Ä‘á»™ng dÃ¹ng MOCK MODE (Ä‘Ã£ hoáº¡t Ä‘á»™ng)

================================================================================
ğŸ“ˆ TIáº¾N Äá»˜ HOÃ€N THÃ€NH
================================================================================

TRÆ¯á»šC KHI CHáº Y AGENT:
  âœ… Database: 100%
  âœ… API REST: 100%
  âœ… NLP PhoBERT: 100%
  âš ï¸  Agent: 0% (chÆ°a cháº¡y)
  âš ï¸  Asterisk: Mock mode
  
  â†’ Tá»”NG: 75%

SAU KHI CHáº Y AGENT:
  âœ… Database: 100%
  âœ… API REST: 100%
  âœ… NLP PhoBERT: 100%
  âœ… Agent: 100% â† Má»šI!
  âš ï¸  Asterisk: Mock mode (OK cho development)
  
  â†’ Tá»”NG: 100% âœ¨

================================================================================
ğŸ¯ ROADMAP TIáº¾P THEO (OPTIONAL)
================================================================================

1. âœ… Deploy lÃªn Railway/Heroku
   - Backend API Ä‘Ã£ sáºµn sÃ ng
   - Agent cÃ³ thá»ƒ cháº¡y riÃªng container

2. âœ… TÃ­ch há»£p RAG (Retrieval Augmented Generation)
   - ThÃªm vector database (Pinecone/Weaviate)
   - Cáº£i thiá»‡n cÃ¢u tráº£ lá»i dá»±a trÃªn knowledge base

3. âœ… Dashboard Admin
   - React/Vue frontend
   - Quáº£n lÃ½ workflows, xem call logs, analytics

4. âœ… Continuous Learning
   - Sá»­ dá»¥ng feedback Ä‘á»ƒ retrain model
   - Scripts Ä‘Ã£ sáºµn sÃ ng: scripts/incremental_retrain.py

================================================================================
ğŸ“ TÃ“M Táº®T NHANH
================================================================================

3 TERMINALS - 3 Lá»†NH:

Terminal 1 - Agent:
  python agent/http_agent.py

Terminal 2 - Backend:
  python -X utf8 -m uvicorn app.main:app --reload

Terminal 3 - Test:
  python test_with_agent.py

Káº¾T QUáº¢ MONG Äá»¢I:
  ğŸ‰ THÃ€NH CÃ”NG! Há»‡ thá»‘ng hoáº¡t Ä‘á»™ng hoÃ n chá»‰nh 100%

================================================================================
