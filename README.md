# VoiceAI-CallOutv2 â€” Complete AI Callbot System

ğŸ¤– **AI-powered Vietnamese callbot** with PhoBERT NLP, Deeppavlov Agent, and FastAPI backend.

[![Tests](https://img.shields.io/badge/tests-8%2F8%20passing-brightgreen)]()
[![Agent](https://img.shields.io/badge/agent-4%2F4%20conversations-brightgreen)]()
[![Coverage](https://img.shields.io/badge/coverage-100%25-brightgreen)]()

## âœ¨ Features
- ğŸ¯ **Intent Classification** (PhoBERT - Vietnamese)
- ğŸ§  **Dialog Management** (Deeppavlov Agent)
- ğŸ“ **Call Orchestration** (Asterisk integration ready)
- ğŸ”’ **JWT Authentication** with bcrypt
- ğŸ“Š **Workflow Versioning** (Git-like system)
- ğŸ—„ï¸ **Supabase PostgreSQL** database
- ğŸ§ª **100% Test Coverage**

## ğŸš€ Quick Start (Windows PowerShell)

### 1. Clone Repository
```powershell
git clone https://github.com/gouenji92/VoiceAI-CallOutv2.git
cd VoiceAI-CallOutv2
```

### 2. Setup Environment
```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
python -m pip install --upgrade pip
python -m pip install -r requirements.txt
```

### 3. Setup Models (AUTO - cháº¡y 1 láº§n duy nháº¥t)
```powershell
python setup_models.py
```
**ChÃº Ã½:** Script nÃ y sáº½ tá»± Ä‘á»™ng train PhoBERT model (~5-10 phÃºt). Model khÃ´ng Ä‘Æ°á»£c push lÃªn Git vÃ¬ quÃ¡ lá»›n (~500MB).

### 4. Configure Environment
```powershell
# Copy file máº«u
cp .env.example .env

# Edit .env vÃ  Ä‘iá»n thÃ´ng tin Supabase
# SUPABASE_URL=https://your-project.supabase.co
# SUPABASE_KEY=your-service-role-key
```

### 5. Run System (3 terminals)
```powershell
# Terminal 1: Agent Server
python agent/http_agent.py

# Terminal 2: Backend API
python -X utf8 -m uvicorn app.main:app --reload

# Terminal 3: Test System
python test_with_agent.py
```

## ğŸ“¦ Why Models Are Not in Git?

PhoBERT models are **~500MB** and exceed GitHub file size limits. Instead:
- âœ… Run `python setup_models.py` after clone (auto-trains from scratch)
- âœ… Takes 5-10 minutes on first setup
- âœ… Model saved locally in `models/phobert-intent-classifier/`

## ğŸ§ª Testing

```powershell
# Full system test (8 API tests)
python test_full_system.py

# Agent integration test (4 conversation flows)
python test_with_agent.py
```

**Expected Results:**
- âœ… 8/8 API tests passing
- âœ… 4/4 Agent conversations passing
- âœ… 100% test coverage

## ğŸ“š Documentation

- **[HUONG_DAN_CHAY_PROJECT_V2.txt](./HUONG_DAN_CHAY_PROJECT_V2.txt)** - HÆ°á»›ng dáº«n cháº¡y Ä‘áº§y Ä‘á»§ (Vietnamese)
- **[HOW_TO_TEST.md](./HOW_TO_TEST.md)** - Testing guide
- **[TONG_HOP_CONG_VIEC.txt](./TONG_HOP_CONG_VIEC.txt)** - Complete work summary
- **[SETUP_GUIDE.md](./SETUP_GUIDE.md)** - Detailed setup instructions

## ğŸ—ï¸ Architecture

```
VoiceAI-CallOutv2/
â”œâ”€â”€ agent/                  # Deeppavlov Agent (dialog logic)
â”‚   â”œâ”€â”€ http_agent.py      # HTTP server (port 4242)
â”‚   â””â”€â”€ skill.py           # Dialog skills
â”œâ”€â”€ app/                   # FastAPI Backend
â”‚   â”œâ”€â”€ routers/           # API endpoints (/auth, /workflows, /calls)
â”‚   â”œâ”€â”€ services/          # Business logic (NLP, dialog, Asterisk)
â”‚   â””â”€â”€ models.py          # Pydantic schemas
â”œâ”€â”€ models/                # PhoBERT models (NOT in Git)
â”‚   â””â”€â”€ phobert-intent-classifier/  # Auto-generated by setup_models.py
â”œâ”€â”€ sql/                   # Database schema & migrations
â”œâ”€â”€ tests/                 # Test suites
â””â”€â”€ setup_models.py        # Auto setup script
```

## ğŸ”§ Tech Stack

- **Backend:** FastAPI 0.115.12, Python 3.11
- **Database:** Supabase (PostgreSQL 15)
- **NLP:** HuggingFace Transformers, PhoBERT
- **Agent:** Deeppavlov (HTTP-based)
- **Auth:** JWT + bcrypt
- **Testing:** pytest, requests

## ğŸ“Š Database Schema

Run in Supabase SQL Editor:
```sql
-- Complete schema with RLS policies
\i sql/schema_complete.sql
```

Tables: `accounts`, `workflows`, `workflow_versions`, `calls`, `conversation_logs`, `call_intents`, `call_entities`, `feedback`, `reports`

## ğŸš¨ Troubleshooting

### "Model not found" error
```powershell
python setup_models.py  # Re-run setup
```

### "Internal Server Error" on registration
Check Supabase RLS policies:
```sql
\i sql/disable_rls_for_app_tables.sql
```

### Agent connection refused
```powershell
python agent/http_agent.py  # Start Agent server first
```

## ğŸ¤ Contributing

1. Fork the repo
2. Create feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. Open Pull Request

## ğŸ“ License

This project is licensed under the MIT License.

## ğŸ‘¥ Authors

- **gouenji92** - *Initial work* - [GitHub](https://github.com/gouenji92)

## ğŸ™ Acknowledgments

- PhoBERT by VinAI Research
- Deeppavlov by MIPT
- FastAPI by SebastiÃ¡n RamÃ­rez
- Supabase team
